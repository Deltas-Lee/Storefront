<div class="cart-layout" *ngIf="items().length; else emptyState" role="region"
  aria-label="Shopping cart">
  <div class="cart-items">
    <div class="cart-header">
      <h2>Your Cart</h2>
      <span class="badge" aria-label="Total items">{{ totalItems() }} item{{
        totalItems() === 1 ? '' : 's' }}</span>
    </div>
    <div class="cart-item" *ngFor="let item of items(); trackBy: trackById">
      <div class="thumb">
        <img [src]="item.product.image" [alt]="item.product.title"
          loading="lazy" />
      </div>
      <div class="details">
        <h3 class="title" [title]="item.product.title">{{ item.product.title }}
        </h3>
        <p class="price">R{{ item.product.price | number:'1.2-2' }}</p>
        <div class="quantity" aria-label="Quantity selector">
          <button type="button" class="qty-btn"
            (click)="decrease(item.product.id)"
            aria-label="Decrease quantity">‚àí</button>
          <span class="qty-value" aria-live="polite">{{ item.quantity }}</span>
          <button type="button" class="qty-btn"
            (click)="increase(item.product.id)"
            aria-label="Increase quantity">+</button>
        </div>
      </div>
      <div class="subtotal">R{{ (item.product.price * item.quantity) |
        number:'1.2-2' }}</div>
      <button type="button" class="remove-item"
        (click)="remove(item.product.id)"
        [attr.aria-label]="'Remove ' + item.product.title + ' from cart'">√ó</button>
    </div>
  </div>
  <aside class="summary" aria-label="Order summary">
    <h3>Summary</h3>
    <div class="line"><span>Items ({{ totalItems() }})</span><span>R{{
        totalPrice() | number:'1.2-2' }}</span></div>
    <div class="line"><span>Estimated Tax (15%)</span><span>R{{ tax() |
        number:'1.2-2' }}</span></div>
    <div class="total"><span>Total</span><span>R{{ (totalPrice() + tax()) |
        number:'1.2-2' }}</span></div>
    <button type="button" class="checkout"
      [disabled]="!items().length">Checkout</button>
    <button type="button" class="clear-cart" (click)="openConfirmModal()"
      [disabled]="!items().length">Clear Cart</button>
    <p class="note">Shipping & final taxes calculated at checkout.</p>
  </aside>
</div>

<!-- Confirmation Modal -->
<div class="confirm-modal-backdrop" *ngIf="showConfirmModal"
  (click)="closeConfirmModal()">
  <div class="confirm-modal" (click)="$event.stopPropagation()" role="dialog"
    aria-labelledby="confirm-title" aria-modal="true">
    <div class="confirm-icon">‚ö†Ô∏è</div>
    <h3 id="confirm-title">Clear Your Cart?</h3>
    <p>Are you sure you want to clear all items from your cart? This action
      cannot be undone.</p>
    <div class="confirm-actions">
      <button type="button" class="btn-cancel"
        (click)="closeConfirmModal()">Cancel</button>
      <button type="button" class="btn-confirm" (click)="confirmClear()">Yes,
        Clear Cart</button>
    </div>
  </div>
</div>

<ng-template #emptyState>
  <div class="empty" role="status" aria-live="polite">
    <div class="empty-icon">üõí</div>
    <h2>Your cart is empty</h2>
    <p>Browse our amazing products and add items to your cart.</p>
    <a routerLink="/products" class="browse-btn">
      <span>View Products</span>
      <span class="arrow">‚Üí</span>
    </a>
  </div>
</ng-template>